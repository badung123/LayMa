@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "Trang chủ";
    //Layout = "_Layout";
}
@model TemplateViewModel;
<h1 id="tokenId" style="display:none">@ViewData["Id"]</h1>
<h1 id="campainId" style="display:none">@Model.CampainId</h1>

<!-- Team-->
<section class="page-section bg-light" id="team">
	<div class="box-step">
		<div class="box-step-wrap fadeInUp visible">
			
			<div id="fingerprint-data">
				<div class="fingerprint-header-container">
					<div class="fingerprint-header">
						<div class="ellipsis-all">   </div>
					</div>
				</div>
			</div>
			<div class="heading -lv2 fadeInUp visible">
				<h2>LÀM THEO CÁC BƯỚC <br class="is-visibleSp"> ĐỂ LẤY LINK TRUY CẬP</h2>
			</div>
			<div class="mt-2">
				<span class="text-danger">Lưu ý : Khi hệ thống đếm giây không được chuyển tab, nếu không sẽ lỗi. Có lỗi sảy ra làm lại từng bước làm OK</span>
			</div>
			
			@if (Model.Flatfrom == "google")
			{
				<div class="box-step-note fadeInUp d-none visible">
					<span>Ghi chú:</span>
					<p>Vị trí của từ khóa là ở top <t id="top" class="text-danger fw-bold"></t> Google!</p>
				</div>
				<p class="box-step-link fadeInUp visible"><a href="#videohd">Xem video hướng dẫn cách lấy mã</a></p>
				<p class="box-step-title fadeInUp visible">Bước 1: Mở tab mới, truy cập <a>Google.com</a></p>
				<p class="fadeInUp visible">(Vui lòng tắt chế độ ẩn danh khi vượt mã)</p>
				<p class="box-step-title fadeInUp visible">Bước 2: Hãy nhớ từ khóa trong ô dưới đây.</p>
				<div class="box-copy fadeInUp mb-3 visible">
					<div class="box-copy-content">
						<p class="box-copy-code" id="TK1">@Model.Key</p>
						<p class="box-copy-button" id="copyCode" onclick="copyKeyGoogle()"><img src="https://yeumoney.com/theme_v2/assets/img/icn-copy.svg" alt="" class="img-fluid"> Copy</p>
						<span id="TK2" data-clipboard-text="@Model.Key"></span>
					</div>
					<p class="message" id="copyMessage"></p>
				</div>
				<p class="box-step-title fadeInUp visible">Bước 3: Gõ từ khóa trên vào tìm kiếm Google</p>
				<div class="box-google fadeInUp visible">
					<div>
						<span class="position-relative display-inline-block">
							<img src="https://yeumoney.com/theme_v2/assets/img/img-tim-kiem-04.webp" alt="" class="img-fluid">
							<span class="position-absolute" id="TK3">@Model.Key</span>
						</span>
					</div>
					<p class="box-google-text">
						<img src="https://yeumoney.com/theme_v2/assets/img/icn-search.svg" alt="" class="img-fluid">
						Tìm rồi bấm vào kết quả giống hình bên dưới
					</p>
					<!-- <p class="box-google-text text-danger fw-normal">
						Hiện tại nhà mạng VNPT, FPT, Vinaphone đã chặn website này. Vui lòng đổi nhà mạng khác để truy cập
					</p> -->
					<span><img id="hinh_nv" src="@Model.UrlImage" alt="" class="img-fluid rounded"></span>

					<div id="halt"></div>

					<p class="box-google-note">Nếu không vào được trang vui lòng đổi trình duyệt khác hoặc xoá cache trình duyệt</p>
					<span><img src="/uploads/img-tim-kiem-03.webp" alt="" class="img-fluid"></span>
					<p class="box-google-note">(Trang 1 không thấy thì tìm qua trang 2 nhé)</p>
				</div>
				<p class="box-step-title fadeInUp visible">Bước 4: Cuộn chậm từ trên xuống tìm nút như hình bên dưới và sau đó click vào</p>
				<p class="box-step-getCode fadeInUp mt-1 visible">
					<span><img src="/uploads/laymabutton.png" alt="" class="img-fluid"></span>
					<span class="text-danger">(Nếu không thấy nút lấy mã, vui lòng trở lại <br class="is-visibleSp">Google và bấm vào website 1 lần nữa)</span>
				</p>
				<p class="box-step-title fadeInUp visible">Bước 5: Sao chép mã hiện ra và nhập vào ô bên dưới</p>
				<a id="xuong"></a>
			}
			else if (Model.Flatfrom == "tructiep")
			{
				<p class="box-step-title fadeInUp visible">Bước 1: Mở tab mới, truy cập liên kết(Vui lòng copy liên kết)</p>
				<div class="box-linkFB-wrap">
					<code id="linkWeb">@Model.UrlWeb</code>
				</div>
				<div class="box-btn-copy">
					<button id="copyUrlWeb" onclick="copyUrlWeb()">Copy</button>
				</div>
				<p class="box-step-title fadeInUp visible">Bước 2: Nhập tên tài khoản và nội dung được tạo sẵn ở dưới,sau đó nhấn gửi</p>
				<div class="box-linkFB-wrap">
					<code id="linkNoidung">@Model.Noidung</code>
				</div>
				<div class="box-btn-copy">
					<button id="copyNoidung" onclick="copyNoidung()">Copy</button>
				</div>
				<span><img src="@Model.UrlImage" alt="" class="img-fluid"></span>
			}
			else
			{
				<p class="box-step-title fadeInUp visible">Bước 1: Mở tab mới, truy cập liên kết(Vui lòng copy liên kết)</p>
				
				<div class="box-linkFB-wrap">
					<code id="linkFB">@Model.UrlFacebook</code>
				</div>
				<div class="box-btn-copy">
					<button id="copyUrlFB" onclick="copyUrlFB()">Copy</button>
				</div>
				
				<p class="box-step-title fadeInUp visible">Bước 2: Truy cập liên kết trong bài viết Facebook</p>
				<span><img src="@Model.UrlImage" alt="" class="img-fluid"></span>
				<p class="box-google-note">(Truy cập link như trong hình)</p>
				<p class="box-step-title fadeInUp visible">Bước 3: Khi website mở ra,hãy cuộn chậm từ trên xuống tìm nút như hình bên dưới và sau đó click vào</p>
				<p class="box-step-getCode fadeInUp mt-1 visible">
					<span><img src="/uploads/laymabutton.png" alt="" class="img-fluid"></span>
					<span class="text-danger">(Nếu không thấy nút lấy mã, vui lòng trở lại <br class="is-visibleSp">Facebook và bấm vào link website 1 lần nữa)</span>
				</p>
				<p class="box-step-title fadeInUp visible">Bước 4: Sao chép mã hiện ra và nhập vào ô bên dưới</p>
				<a id="xuong"></a>
			}
			
			<div class="box-form">
				<div class="">
					<div class="box-form-wrap">
						<input type="text" class="form-control" id="codeInput" name="code" required="required" placeholder="Nhập mã vào đây">
					</div>
					<div class="mt-3">
						<div class="g-recaptcha" data-sitekey="@ViewData["SiteKey"]"></div><br>
						<span class="text-danger">Lưu ý : Khi hệ thống đếm giây không được chuyển tab, nếu không sẽ lỗi. Có lỗi sảy ra làm lại từng bước làm OK</span>
					</div>
					<div class="box-form-button mt-3">
						<button type="submit" class="btn btn-primary" id="btn-xac-nhan" onclick="confirm1();">Xác nhận</button>
						<a id="btn-baoloi" class="btn btn-success" onclick="clickDoiNhiemVu();">Đổi nhiệm vụ</a>
					</div>	
				</div>
			</div>

			<a id="videohd"></a>
			<div class="box-video fadeInUp visible">
				<p class="box-video-title fadeInUp visible">VIDEO HƯỚNG DẪN CÁCH LẤY MÃ</p>
				<div class="box-video-youtube fadeInUp visible">
					
					<!-- Video Grid Container -->
					<div class="video-grid">
						@if (Model.Flatfrom == "google")
						{
							<!-- Solution1 Video -->
							<div class="video-item">
								<h4 class="video-title">Solution 1</h4>
								<div class="video-container">
									<video id="google-video"
										   class="responsive-video"
										   controls
										   preload="metadata"
										   poster="/uploads/google-poster.jpg"
										   playsinline
										   webkit-playsinline>
										<source src="/uploads/google.mp4" type="video/mp4">
										<source src="/uploads/google.webm" type="video/webm">
										<p>Trình duyệt của bạn không hỗ trợ video. <a href="/uploads/google.mp4">Tải video</a></p>
									</video>
								</div>
							</div>

							<!-- Solution2 Video -->
							<div class="video-item">
								<h4 class="video-title">Solotion 2</h4>
								<div class="video-container">
									<video id="facebook-video"
										   class="responsive-video"
										   controls
										   preload="metadata"
										   poster="/uploads/facebook-poster.jpg"
										   playsinline
										   webkit-playsinline>
										<source src="/uploads/google2.mp4" type="video/mp4">
										<source src="/uploads/google2.webm" type="video/webm">
										<p>Trình duyệt của bạn không hỗ trợ video. <a href="/uploads/google2.mp4">Tải video</a></p>
									</video>
								</div>
							</div>
						}
						else
						{
							<!-- Solution1 Video -->
							<div class="video-item">
								<h4 class="video-title">Solution 1</h4>
								<div class="video-container">
									<video id="google-video"
										   class="responsive-video"
										   controls
										   preload="metadata"
										   poster="/uploads/google-poster.jpg"
										   playsinline
										   webkit-playsinline>
										<source src="/uploads/video_fb_hd.mp4" type="video/mp4">
										<source src="/uploads/video_fb_hd.webm" type="video/webm">
										<p>Trình duyệt của bạn không hỗ trợ video. <a href="/uploads/video_fb_hd.mp4">Tải video</a></p>
									</video>
								</div>
							</div>

							<!-- Solution2 Video -->
							<div class="video-item">
								<h4 class="video-title">Solotion 2</h4>
								<div class="video-container">
									<video id="facebook-video"
										   class="responsive-video"
										   controls
										   preload="metadata"
										   poster="/uploads/facebook-poster.jpg"
										   playsinline
										   webkit-playsinline>
										<source src="/uploads/facebook2.mp4" type="video/mp4">
										<source src="/uploads/facebook2.webm" type="video/webm">
										<p>Trình duyệt của bạn không hỗ trợ video. <a href="/uploads/facebook2.mp4">Tải video</a></p>
									</video>
								</div>
							</div>
						}
						
					</div>
				</div>
			</div>

			<!-- Video Styles for Web and Mobile -->
			<style>
				/* Video Grid Layout */
				.video-grid {
					display: grid;
					grid-template-columns: 1fr 1fr;
					gap: 20px;
					width: 100%;
					max-width: 1200px;
					margin: 0 auto;
				}

				.video-item {
					display: flex;
					flex-direction: column;
					align-items: center;
				}

				.video-title {
					font-size: 18px;
					font-weight: bold;
					margin-bottom: 15px;
					color: #333;
					text-align: center;
				}

				.video-container {
					position: relative;
					width: 100%;
					max-width: 100%; /* Remove fixed max-width to maintain original width */
					margin: 0 auto;
					background: #000;
					border-radius: 8px;
					overflow: hidden;
					box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
				}

				.responsive-video {
					width: 100%;
					height: auto;
					display: block;
					/* Remove aspect-ratio to maintain original video dimensions */
					object-fit: contain; /* Changed from cover to contain */
				}

				/* Mobile Optimizations */
				@@media (max-width: 768px) {
					.video-grid {
						grid-template-columns: 1fr; /* Stack videos vertically on mobile */
						gap: 30px;
					}

					.video-container {
						max-width: 100%;
						margin: 0 10px;
						border-radius: 6px;
					}

					.responsive-video {
						/* Remove aspect-ratio constraint on mobile */
						max-height: 60vh;
						width: 100%;
					}

					.box-video-title {
						font-size: 16px !important;
						margin-bottom: 15px !important;
					}

					.video-title {
						font-size: 16px;
						margin-bottom: 10px;
					}

					/* Mobile video controls optimization */
					.responsive-video::-webkit-media-controls {
						background-color: rgba(0, 0, 0, 0.7);
					}

					.responsive-video::-webkit-media-controls-panel {
						padding: 8px;
					}

					.responsive-video::-webkit-media-controls-play-button {
						background-color: rgba(255, 255, 255, 0.9);
						border-radius: 50%;
						width: 40px;
						height: 40px;
					}
				}

				/* Tablet Optimizations */
				@@media (min-width: 769px) and (max-width: 1024px) {
					.video-grid {
						grid-template-columns: 1fr 1fr; /* Keep side by side on tablet */
						gap: 15px;
					}

					.video-container {
						max-width: 100%; /* Maintain original width on tablet */
					}

					.responsive-video {
						/* Remove aspect-ratio constraint on tablet */
						max-height: 70vh;
						width: 100%;
					}

					.video-title {
						font-size: 16px;
					}
				}

				/* Desktop Optimizations */
				@@media (min-width: 1025px) {
					.video-grid {
						grid-template-columns: 1fr 1fr; /* Side by side on desktop */
						gap: 30px;
					}

					.video-container {
						max-width: 100%; /* Maintain original width on desktop */
					}

					.responsive-video {
						/* Remove aspect-ratio constraint on desktop */
						max-height: 80vh;
						width: 100%;
					}

					.video-title {
						font-size: 20px;
					}
				}

				/* Video Loading States */
				.video-container::before {
					content: '';
					position: absolute;
					top: 50%;
					left: 50%;
					transform: translate(-50%, -50%);
					width: 40px;
					height: 40px;
					border: 3px solid #f3f3f3;
					border-top: 3px solid #3498db;
					border-radius: 50%;
					animation: spin 1s linear infinite;
					z-index: 1;
					opacity: 0;
					transition: opacity 0.3s;
				}

				.video-container.loading::before {
					opacity: 1;
				}

				@@keyframes spin {
					0% { transform: translate(-50%, -50%) rotate(0deg); }
					100% { transform: translate(-50%, -50%) rotate(360deg); }
				}

				/* Video Error State */
				.video-error {
					position: absolute;
					top: 50%;
					left: 50%;
					transform: translate(-50%, -50%);
					text-align: center;
					color: #fff;
					background: rgba(0, 0, 0, 0.8);
					padding: 20px;
					border-radius: 8px;
					display: none;
				}

				.video-container.error .video-error {
					display: block;
				}
			</style>

			<!-- Video JavaScript for Enhanced Functionality -->
			<script>
				// Mobile detection utility
				const isMobile = {
					Android: function() {
						return navigator.userAgent.match(/Android/i);
					},
					BlackBerry: function() {
						return navigator.userAgent.match(/BlackBerry/i);
					},
					iOS: function() {
						return navigator.userAgent.match(/iPhone|iPad|iPod/i);
					},
					Opera: function() {
						return navigator.userAgent.match(/Opera Mini/i);
					},
					Windows: function() {
						return navigator.userAgent.match(/IEMobile/i);
					},
					any: function() {
						return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());
					}
				};

				// Video quality detection
				const getVideoQuality = function() {
					const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
					if (connection) {
						if (connection.effectiveType === '4g') return 'high';
						if (connection.effectiveType === '3g') return 'medium';
						return 'low';
					}
					return 'medium'; // Default fallback
				};

				document.addEventListener('DOMContentLoaded', function() {
					const videos = document.querySelectorAll('.responsive-video');
					
					videos.forEach(function(video) {
						const container = video.closest('.video-container');
						
						// Show loading state
						container.classList.add('loading');
						
						// Handle video events
						video.addEventListener('loadedmetadata', function() {
							container.classList.remove('loading');
							trackVideoEvent('loaded', video.id);
						});
						
						video.addEventListener('error', function() {
							container.classList.remove('loading');
							container.classList.add('error');
							showVideoError(container);
							trackVideoEvent('error', video.id);
						});
						
						video.addEventListener('play', function() {
							trackVideoEvent('play', video.id);
						});
						
						video.addEventListener('pause', function() {
							trackVideoEvent('pause', video.id);
						});
						
						video.addEventListener('ended', function() {
							trackVideoEvent('ended', video.id);
						});
						
						// Mobile optimizations
						if (isMobile.any()) {
							video.setAttribute('playsinline', '');
							video.setAttribute('webkit-playsinline', '');
							video.setAttribute('x-webkit-airplay', 'allow');
							
							// Prevent fullscreen on mobile
							video.addEventListener('webkitbeginfullscreen', function() {
								video.webkitExitFullscreen();
							});
							
							// Add touch-friendly controls
							addMobileControls(video, container);
						}
						
						// Auto-pause when video is not visible
						const observer = new IntersectionObserver(function(entries) {
							entries.forEach(function(entry) {
								if (!entry.isIntersecting && !video.paused) {
									video.pause();
								}
							});
						}, { threshold: 0.5 });
						
						observer.observe(video);
						
						// Add keyboard shortcuts for desktop
						if (!isMobile.any()) {
							document.addEventListener('keydown', function(e) {
								if (document.activeElement === video || video.contains(document.activeElement)) {
									switch(e.code) {
										case 'Space':
											e.preventDefault();
											video.paused ? video.play() : video.pause();
											break;
										case 'ArrowRight':
											e.preventDefault();
											video.currentTime += 10;
											break;
										case 'ArrowLeft':
											e.preventDefault();
											video.currentTime -= 10;
											break;
									}
								}
							});
						}
					});
				});
				
				function addMobileControls(video, container) {
					// Add custom mobile play button overlay
					const playOverlay = document.createElement('div');
					playOverlay.className = 'mobile-play-overlay';
					playOverlay.innerHTML = '<div class="play-button">▶</div>';
					playOverlay.style.cssText = `
						position: absolute;
						top: 0;
						left: 0;
						right: 0;
						bottom: 0;
						background: rgba(0,0,0,0.3);
						display: flex;
						align-items: center;
						justify-content: center;
						z-index: 2;
						cursor: pointer;
						transition: opacity 0.3s;
					`;
					
					playOverlay.querySelector('.play-button').style.cssText = `
						width: 60px;
						height: 60px;
						background: rgba(255,255,255,0.9);
						border-radius: 50%;
						display: flex;
						align-items: center;
						justify-content: center;
						font-size: 24px;
						color: #333;
					`;
					
					playOverlay.addEventListener('click', function() {
						video.play();
						playOverlay.style.opacity = '0';
						setTimeout(() => playOverlay.style.display = 'none', 300);
					});
					
					container.appendChild(playOverlay);
					
					// Hide overlay when video starts playing
					video.addEventListener('play', function() {
						playOverlay.style.opacity = '0';
						setTimeout(() => playOverlay.style.display = 'none', 300);
					});
					
					// Show overlay when video pauses
					video.addEventListener('pause', function() {
						playOverlay.style.display = 'flex';
						playOverlay.style.opacity = '1';
					});
				}
				
				function showVideoError(container) {
					const errorDiv = document.createElement('div');
					errorDiv.className = 'video-error';
					errorDiv.innerHTML = `
						<h4>Không thể tải video</h4>
						<p>Vui lòng kiểm tra kết nối mạng và thử lại</p>
						<button onclick="retryVideo('${container.querySelector('video').id}')" style="
							background: #007bff; 
							color: white; 
							border: none; 
							padding: 8px 16px; 
							border-radius: 4px; 
							cursor: pointer;
							margin-top: 10px;
						">Thử lại</button>
					`;
					container.appendChild(errorDiv);
				}
				
				function retryVideo(videoId) {
					const video = document.getElementById(videoId);
					const container = video.closest('.video-container');
					
					// Remove error state
					container.classList.remove('error');
					const errorDiv = container.querySelector('.video-error');
					if (errorDiv) errorDiv.remove();
					
					// Show loading state
					container.classList.add('loading');
					
					// Reload video
					video.load();
					video.play().catch(() => {
						// If autoplay fails, that's okay
					});
				}
				
				// Video analytics tracking
				function trackVideoEvent(event, videoId) {
					// You can implement analytics tracking here
					console.log('Video event:', event, 'Video ID:', videoId, 'Quality:', getVideoQuality(), 'Mobile:', isMobile.any());
					
					// Example: Send to analytics service
					// if (typeof gtag !== 'undefined') {
					//     gtag('event', 'video_' + event, {
					//         'video_id': videoId,
					//         'quality': getVideoQuality(),
					//         'mobile': isMobile.any()
					//     });
					// }
				}
			</script>



			<!-- ----------------------------  Custom css ------------------------------ -->
			<style>
				.css-lam-mo {
					background: rgba(0, 0, 0, 0.8);
					z-index: 51;
					position: fixed;
					bottom: 0px;
					left: 0px;
					right: 0px;
					top: 0px;
				}

				.my-vien-ngoai {
					margin: auto;
					background: #ffffff;
					width: 100%;
					max-width: 320px;
					border-radius: 6px;
					z-index: 52;
					position: fixed;
					top: 17%;
					right: 5%;
					left: 5%;
				}

				.vien-vip {
					height: unset !important;
					padding: 15px 15px 15px 15px;
					overflow-x: auto
				}

				.tat {
					float: right;
					padding-right: 5px;
					font-size: 22px;
					margin-top: -5px;
				}
				/* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding-top: 200px; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
  position: relative;
  background-color: #fefefe;
  margin: auto;
  padding: 0;
  border: 1px solid #888;
  width: 50%;
  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
}

/* The Close Button */
.close {
  color: white;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.closeNhiemVu {
	color: white;
	float: right;
	font-size: 28px;
	font-weight: bold;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}

.closeNhiemVu:hover,
.closeNhiemVu:focus {
	color: #000;
	text-decoration: none;
	cursor: pointer;
}

.modal-header {
  padding: 2px 16px;
					background-color: #5cb85c;
  color: white;
}

.modal-body {padding: 2px 16px;text-align:center}

.modal-footer {
  padding: 2px 16px;
					background-color: #5cb85c;
  color: white;
}
			</style>

			
			


			<!-- --------------------------------- Kết quả -------------------------------- -->

			<span id="ketqua"></span>
		</div>
	</div>
</section>
<div id="myModalThongbao" class="modal">
	<div class="modal-content">
		<div id="modalHeader" class="modal-header">
			<h2>Thông báo</h2>
			<span class="close">&times;</span>
		</div>
		<div class="modal-body">
			<p id="noidung"></p>
			<p id="countRedirect" style="display:none;font-size:30px"></p>
		</div>
		<div id="modalFooter" class="modal-footer">
			<button type="submit" class="btn btn-success" id="redirect">OK</button>
			<button type="submit" class="btn btn-primary" id="closeThongBao" onclick="closeThongBao();">Đóng</button>
		</div>
	</div>
</div>
<div id="myModalNhiemVu" class="modal">
	<div class="modal-content">
		<div id="modalHeaderNhiemVu" class="modal-header">
			<h2>Đổi Nhiệm Vụ</h2>
			<span class="closeNhiemVu">&times;</span>
		</div>
		<div class="modal-body">
			<p id="noidungNhiemVu">Bạn có chắc muốn đổi nhiệm vụ?</p>
		</div>
		<div id="modalFooterNhiemVu" class="modal-footer">
			<button type="submit" class="btn btn-primary" onclick="doiNhiemVu();">Xác nhận</button>
			<button type="submit" class="btn btn-success" onclick="closeDoiNhiemVu();">Đóng</button>
		</div>
	</div>
</div>
@* @section Scripts {
						@if (Model.Captcha.IsEnabled)
						{
							@if (Model.Captcha.IsVersion2())
							{
								<script src="https://www.google.com/recaptcha/api.js" defer></script>
							}

							@if (Model.Captcha.IsVersion3())
							{
								<script src="https://www.google.com/recaptcha/api.js?render=@Model.Captcha.SiteKey"></script>
								<script>
									function onSubmit(token) {
										console.log(token)
									}
								</script>
							}
						}
					} *@
<script>
	
	const ajax = function(url, method = 'GET', data, onSuccess = null, onError = null, onDone = null) {
        let postData = JSON.stringify(data);
        let xhr = new XMLHttpRequest();

        xhr.open(method, url, true);
        xhr.setRequestHeader('Content-type', 'application/json; charset=UTF-8');
        xhr.send(postData);
        console.log(postData);

        xhr.addEventListener('load', function(event) {
            if (onSuccess) onSuccess(JSON.parse(event.target.response));
            if (onDone) onDone();
        });

        xhr.addEventListener('error', function(event) {
            if (onError) onError(event);
            if (onDone) onDone();
        });
    }

    const ajaxGet = function(url, onSuccess = null, onError = null, onDone = null) {
        return ajax(url, 'GET', [], onSuccess, onError, onDone);
    }

    const ajaxPost = function(url, data, onSuccess = null, onError = null, onDone = null) {
        return ajax(url, 'POST', data, onSuccess, onError, onDone);
    }
	const uuidv4 = function() {
        if (typeof crypto == 'object') {
            return uuidv4ByCrypto();
        }

        return uuidv4ByMath();
    }
	const uuidv4ByMath = function() {
        let d = new Date().getTime();//Timestamp
        let d2 = ((typeof performance !== 'undefined') && performance.now && (performance.now()*1000)) || 0;//Time in microseconds since page-load or 0 if unsupported
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
            let r = Math.random() * 16;//random number between 0 and 16
            if(d > 0){//Use timestamp until depleted
                r = (d + r)%16 | 0;
                d = Math.floor(d/16);
            } else {//Use microseconds since page-load if supported
                r = (d2 + r)%16 | 0;
                d2 = Math.floor(d2/16);
            }
            return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
        });
    }

    const uuidv4ByCrypto = function() {
        return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, function (c) {
            return (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
        });
    }
	const getVisitorUUID = function () {
		let uuid;

		try {
			uuid = localStorage.getItem("__" + '@Html.Raw(ViewData["Id"])' + "_uuid");
			if (uuid === null) {
				uuid = uuidv4();
				localStorage.setItem("__" + '@Html.Raw(ViewData["Id"])' + "_uuid", uuid);
			}
		} catch (e) {
			uuid = uuidv4();
		}

		return uuid;
	}

	const getVisitorInfo = function () {
		var unknown = "-";
		var screenSize = "";
		if (screen.width) {
			width = screen.width ? screen.width : "";
			height = screen.height ? screen.height : "";
			screenSize += "" + width + " x " + height;
		}
		var nVer = navigator.appVersion;
		var nAgt = navigator.userAgent;
		var browser = navigator.appName;
		var version = "" + parseFloat(navigator.appVersion);
		var majorVersion = parseInt(navigator.appVersion, 10);
		var nameOffset, verOffset, ix;
		if ((verOffset = nAgt.indexOf("Opera")) != -1) {
			browser = "Opera";
			version = nAgt.substring(verOffset + 6);
			if ((verOffset = nAgt.indexOf("Version")) != -1) {
				version = nAgt.substring(verOffset + 8);
			}
		}
		if ((verOffset = nAgt.indexOf("OPR")) != -1) {
			browser = "Opera";
			version = nAgt.substring(verOffset + 4);
		} else if ((verOffset = nAgt.indexOf("MSIE")) != -1) {
			browser = "Microsoft Internet Explorer";
			version = nAgt.substring(verOffset + 5);
		} else if ((verOffset = nAgt.indexOf("Chrome")) != -1) {
			browser = "Chrome";
			version = nAgt.substring(verOffset + 7);
		} else if ((verOffset = nAgt.indexOf("Safari")) != -1) {
			browser = "Safari";
			version = nAgt.substring(verOffset + 7);
			if ((verOffset = nAgt.indexOf("Version")) != -1) {
				version = nAgt.substring(verOffset + 8);
			}
		} else if ((verOffset = nAgt.indexOf("Firefox")) != -1) {
			browser = "Firefox";
			version = nAgt.substring(verOffset + 8);
		} else if (nAgt.indexOf("Trident/") != -1) {
			browser = "Microsoft Internet Explorer";
			version = nAgt.substring(nAgt.indexOf("rv:") + 3);
		} else if (
			(nameOffset = nAgt.lastIndexOf(" ") + 1) <
			(verOffset = nAgt.lastIndexOf("/"))
		) {
			browser = nAgt.substring(nameOffset, verOffset);
			version = nAgt.substring(verOffset + 1);
			if (browser.toLowerCase() == browser.toUpperCase()) {
				browser = navigator.appName;
			}
		}
		if ((ix = version.indexOf(";")) != -1) version = version.substring(0, ix);
		if ((ix = version.indexOf(" ")) != -1) version = version.substring(0, ix);
		if ((ix = version.indexOf(")")) != -1) version = version.substring(0, ix);
		majorVersion = parseInt("" + version, 10);
		if (isNaN(majorVersion)) {
			version = "" + parseFloat(navigator.appVersion);
			majorVersion = parseInt(navigator.appVersion, 10);
		}
		var mobile = /Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(nVer);
		var cookieEnabled = navigator.cookieEnabled ? true : false;
		if (typeof navigator.cookieEnabled == "undefined" && !cookieEnabled) {
			document.cookie = "testcookie";
			cookieEnabled =
				document.cookie.indexOf("testcookie") != -1 ? true : false;
		}
		var os = unknown;
		var clientStrings = [{
			s: "Windows 10",
			r: /(Windows 10.0|Windows NT 10.0)/
		},
		{
			s: "Windows 8.1",
			r: /(Windows 8.1|Windows NT 6.3)/
		},
		{
			s: "Windows 8",
			r: /(Windows 8|Windows NT 6.2)/
		},
		{
			s: "Windows 7",
			r: /(Windows 7|Windows NT 6.1)/
		},
		{
			s: "Windows Vista",
			r: /Windows NT 6.0/
		},
		{
			s: "Windows Server 2003",
			r: /Windows NT 5.2/
		},
		{
			s: "Windows XP",
			r: /(Windows NT 5.1|Windows XP)/
		},
		{
			s: "Windows 2000",
			r: /(Windows NT 5.0|Windows 2000)/
		},
		{
			s: "Windows ME",
			r: /(Win 9x 4.90|Windows ME)/
		},
		{
			s: "Windows 98",
			r: /(Windows 98|Win98)/
		},
		{
			s: "Windows 95",
			r: /(Windows 95|Win95|Windows_95)/
		},
		{
			s: "Windows NT 4.0",
			r: /(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/
		},
		{
			s: "Windows CE",
			r: /Windows CE/
		},
		{
			s: "Windows 3.11",
			r: /Win16/
		},
		{
			s: "Android",
			r: /Android/
		},
		{
			s: "Open BSD",
			r: /OpenBSD/
		},
		{
			s: "Sun OS",
			r: /SunOS/
		},
		{
			s: "Linux",
			r: /(Linux|X11)/
		},
		{
			s: "iOS",
			r: /(iPhone|iPad|iPod)/
		},
		{
			s: "Mac OS X",
			r: /Mac OS X/
		},
		{
			s: "Mac OS",
			r: /(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/
		},
		{
			s: "QNX",
			r: /QNX/
		},
		{
			s: "UNIX",
			r: /UNIX/
		},
		{
			s: "BeOS",
			r: /BeOS/
		},
		{
			s: "OS/2",
			r: /OS\/2/
		},
		{
			s: "Search Bot",
			r: /(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/,
		},
		];
		for (var id in clientStrings) {
			var cs = clientStrings[id];
			if (cs.r.test(nAgt)) {
				os = cs.s;
				break;
			}
		}
		var osVersion = unknown;
		if (/Windows/.test(os)) {
			osVersion = /Windows (.*)/.exec(os)[1];
			os = "Windows";
		}
		switch (os) {
			case "Mac OS X":
				osVersion = /Mac OS X (10[\.\_\d]+)/.exec(nAgt)[1];
				break;
			case "Android":
				osVersion = /Android ([\.\_\d]+)/.exec(nAgt)[1];
				break;
			case "iOS":
				osVersion = /OS (\d+)_(\d+)_?(\d+)?/.exec(nVer);
				osVersion =
					osVersion[1] + "." + osVersion[2] + "." + (osVersion[3] | 0);
				break;
		}
		if (typeof swfobject != "undefined") {
			var fv = swfobject.getFlashPlayerVersion();
			if (fv.major > 0) {
				flashVersion = fv.major + "." + fv.minor + " r" + fv.release;
			} else {
				flashVersion = unknown;
			}
		}

		return {
			uuid: getVisitorUUID(),
			browser: browser,
			browserVersion: version,
			browserMajorVersion: majorVersion,
			cookies: cookieEnabled,
			mobile: mobile,
			os: os,
			osVersion: osVersion,
			screen: screenSize,
			userAgent: nAgt
		};
	}
	// Get the modal
	var modalThongbao = document.getElementById("myModalThongbao");

	// Get the <span> element that closes the modal
	var spanThongbao = document.getElementsByClassName("close")[0];

	// When the user clicks on <span> (x), close the modal
	spanThongbao.onclick = function() {
	  modalThongbao.style.display = "none";
	}
	// Get the modal
	var modalNhiemVu = document.getElementById("myModalNhiemVu");

	// Get the <span> element that closes the modal
	var spanNhiemVu = document.getElementsByClassName("closeNhiemVu")[0];

	// When the user clicks on <span> (x), close the modal
	spanNhiemVu.onclick = function () {
		modalNhiemVu.style.display = "none";
	}
	function displayError(error){
		modalThongbao.style.display = "block";
		document.getElementById("modalHeader").style.backgroundColor = "red";
		document.getElementById("modalFooter").style.backgroundColor = "red";
		document.getElementById("countRedirect").style.display = "none";
		document.getElementById("noidung").innerHTML = error;
	}
	function displaySuccess(noidung){
		modalThongbao.style.display = "block";
		document.getElementById("modalHeader").style.backgroundColor = "#5cb85c";
		document.getElementById("modalFooter").style.backgroundColor = "#5cb85c";
		document.getElementById("noidung").innerHTML = noidung;
	}
	function confirm(){
		let reCaptchaResponse = grecaptcha.getResponse();
        if(reCaptchaResponse){
            $.getJSON("/Template/Verify?token=" + reCaptchaResponse,
                    function (data) {
                        if (data) {
                            confirm1();
                        }
                        else {
                            displayError("Thao tác không thật");
                        }
                    });
        }
	}
	function confirm1() {
		 
		var code = document.getElementById("codeInput").value;
		if(code == null || code == ""){
			displayError("Bạn chưa nhập mã code");
		}
		var tokenId = document.getElementById("tokenId").innerHTML;
		
		var campainId = document.getElementById("campainId").innerHTML;
		if (campainId == null || campainId == "") {
			displayError("Chiến dịch không tồn tại");
		}
		var clientInformation = getVisitorInfo();
		var postData = {
			"Code":code,
			"Token":tokenId,
			"CampainId":campainId,
			"UserAgent":clientInformation.userAgent,
			"DeviceScreen":clientInformation.screen
		};
		$.ajax({
			url: '@Html.Raw(ViewData["ApiUrl"])' + '/api/admin/codemanager/checkcode',
			type: 'POST',
			contentType: 'application/json',
			data: JSON.stringify(postData),
			success: function (result) {
				displaySuccess("Nhập code thành công");
				spanThongbao.style.display = "none"; 
				document.getElementById("closeThongBao").style.display = "none";
				document.getElementById("redirect").style.display = "none";
				document.getElementById("countRedirect").style.display = "block";
				let n = 3;
				document.getElementById("countRedirect").innerHTML = n;
				let t = setInterval(function(){
					n--;
					document.getElementById("countRedirect").innerHTML = n;
					if(n== 0){
						clearInterval(t)
						modalThongbao.style.display = "none";
						window.open(result,"_self");
					}
				},1e3)
							
			},
			error: function (error) {
				displayError(error.responseText);
				document.getElementById("redirect").style.display = "none";
			}
		});
	}
	function clickDoiNhiemVu() {
		modalNhiemVu.style.display = "block";
	}
	function closeDoiNhiemVu() {
		modalNhiemVu.style.display = "none";
	}
	function closeThongBao() {
		modalThongbao.style.display = "none";
	}
	function doiNhiemVu() {
		modalNhiemVu.style.display = "none";
		var tokenId = document.getElementById("tokenId").innerHTML;
		var postData = {
			"Token": tokenId,
		};
		$.ajax({
			url: '@Html.Raw(ViewData["ApiUrl"])' + '/api/admin/mission/changeMission',
			type: 'POST',
			contentType: 'application/json',
			data: JSON.stringify(postData),
			success: function (result) {
				window.location.reload();
			},
			error: function (error) {
				displayError(error.responseText);
				document.getElementById("redirect").style.display = "none";
			}
		});
	}
	function copyUrlFB() {
		// Get the text field
		var copyText = document.getElementById("linkFB");

		@* // Select the text field
		copyText.select();
		copyText.setSelectionRange(0, 99999); // For mobile devices *@

		// Copy the text inside the text field
		navigator.clipboard.writeText(copyText.innerHTML);
		document.getElementById("copyUrlFB").innerHTML = "Đã copy";
	}
	function copyUrlWeb() {
		// Get the text field
		var copyText = document.getElementById("linkWeb");

	@* // Select the text field
			copyText.select();
			copyText.setSelectionRange(0, 99999); // For mobile devices *@

			// Copy the text inside the text field
			navigator.clipboard.writeText(copyText.innerHTML);
		document.getElementById("copyUrlWeb").innerHTML = "Đã copy";
	}
	function copyNoidung() {
		// Get the text field
		var copyText = document.getElementById("linkNoidung");

	@* // Select the text field
			copyText.select();
			copyText.setSelectionRange(0, 99999); // For mobile devices *@

			// Copy the text inside the text field
			navigator.clipboard.writeText(copyText.innerHTML);
		document.getElementById("copyNoidung").innerHTML = "Đã copy";
	}
	function copyKeyGoogle(){
		// Get the text field
		var copyText = document.getElementById("TK1");

	@* // Select the text field
			copyText.select();
			copyText.setSelectionRange(0, 99999); // For mobile devices *@

			// Copy the text inside the text field
			navigator.clipboard.writeText(copyText.innerHTML);
		document.getElementById("copyCode").innerHTML = "Đã Copy";
	}
	
	ajaxPost(
		'@Html.Raw(ViewData["ApiUrl"])' + "/api/admin/visitor",
		{
			...getVisitorInfo(),
			token: '@Html.Raw(ViewData["Id"])'
		},
		(result) => {
			if(result.success){
				
			}else{
				
			}
		})
</script>

